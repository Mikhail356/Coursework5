# Поиск упоминаний персон
Как и было указано ранее весь поиск конкретной информации в тексте можно разбить на несколько групп в зависимости от того какой способ нормализации мы используем. Существуют разные способы нормализации текстов. На их основе существуют различные способы поиска - статистическая, усекающая и смешанная. Также можно использовать регулярные выражения.

## Определения
1. Полнотекстовый поиск - поиск который ведется по всему документу или по существенной его части.
1. Стемминг - процесс редуцирования слова до его основы или корня.
1. Лемматизация - приведение словоформы к начальной форме.
1. Начальная форма слова - единственная форма для каждого слова. В русском языке для существительных это единственное число, именительный падеж, глаголов - инфинитив, прилагательные - мужской род, единственное число и так далее.
1. Нормализация слова - приведение слова к его начальной форме.

## Описание модели
В данной работе используется стемминг и на нем строится усекающая модель нормализации текстов, так как нет доступа к нужными вычислительными ресурсами для применения остальных.

Также так как было выгружено около 100 000 различных записей их нужно правильно индексировать и искать по ним, так как пройти 100 000 последовательностей из более чем 10 000 символов на Python довольно долго. Поэтому используем python с подключенной к нему sqlite и прямые SQL запросы. Для полнотекстового поиска используем fts5[@SQLiteFTS5Extension], это специальный набор команд для работы с виртуальными таблицами в sqlite и поддерживающий полнотекстовый поиск. При помощи нее создается B-дерево всех документов. Так получается кратно ускорить работу полнотекстового поиска по базе данных. Для самого полнотекстового поиска используется отбрасывание окончаний у имени, фамилии и отчества в итоге оставшаяся основа слова при помощи регулярного выражения прогоняется по всей базе текстов.

На втором этапе уже составляется таблица пересечений людей в одном тексте (то есть встретились 2 одинаковые фамилии). Дальше уже на оставшихся текстах происходит прогон на наличие в тексте также соответствующих имен и отчеств. Этот этап позволяет избавиться от таких совпадений как для фамилии Орехов и слова орехи, фамилии Толстой и слова толстой. Поиск осуществляется не по всему тексту, а только по его небольшому интервалу вокруг предполагаемо найденной фамилии. В работе используется интервал от 50 до 100 символов, так как существуют двойные фамилии а также длинные южные.

Проиллюстрировать работу программы по поиску упоминаний людей в тексте можно следующей диаграммой [Рис. 2]


![text_processing.png](diagrams/text_processing)

                        Рис. 2: Работа поиска 

## Математическая модель поиска

Пусть у нас есть мультимножества 
$$man(id(t_1), lastname(t_2), firstname(t_2), middlename(t_2), expert(t_3))$$ 
и 
$$content(id(t_1), url(t_2), cont(t_2)).$$
Тогда математическая модель поиска кортежей из мультимножества 
$$man(id(t_1), lastname(t_2), firstname(t_2), middlename(t_2), expert(t_3))$$ 
в мультимножестве 
$$content(id(t_1), url(t_2), cont(t_2))$$
будет являться отображением $s: man \rightarrow \{0,1 \}^n$, где $n = \# \{id \in man\}$.
Дальше опускаем указание типов, так как они остаются неизменными. Функцию стемминга обозначим:
$$stem(a_1...a_n) = \begin{cases} a_1...a_n, \texttt{ если  } a_n \neq  "a" \\ a_1...a_{n-1}, \texttt{ иначе} \end{cases}$$
Тогда узнать есть ли упоминание человека $\pi(man)_{\sigma(id = t)}$ в таблице текстов $content$ можно так
$$s_1(\pi(man)_{\sigma(id = t)}, content) :=$$
$$ \{(t,\quad H(\#\bigcup\limits_{g = 1}^{\#\{id \in content\}} \pi(content)_{\sigma(stem(man(id=t, lastname)) \in content(id = g, cont))})),\},$$
где $H$ сдвинутая функция Хевисайда:
$$H: \mathbb{N} \rightarrow \{0,1\}$$
$$H(n) =  \begin{cases} 0,\quad n < 1\\ 1, \quad n \ge 1 \end{cases}$$

Узнать же записи в которых упоминается человек можно следующим образом:

$$s_0(\pi(man)_{\sigma(id = t)}, content) :=$$
$$ \{(t, \quad\bigcup\limits_{g = 1}^{\#\{id \in content\}} \pi(content(id))_{\sigma(stem(man(id=t, lastname)) \in content(id = g, cont))}),\}$$

Если будет искаться несколько элементов из таблицы, то ответом будут множества размера в количество разыскиваемых элементов. Каждый элемент будет являться упорядоченной парой с первым аргументом номером id, а вторым найденными значениями.

Чтобы найти позицию элемента $a_1...a_n$ в тексте $text$ будем использовать $fts(a_1...a_n, text)$.
Тогда узнать позицию слова в тексте можно так:
$$s_2(\pi(man)_{\sigma(id = t)}, content) :=$$
$$ \{(t, \quad\bigcup\limits_{g = 1}^{\#\{id \in content\}} fts(stem(man(id=t, lastname)),$$
$$\pi(content(cont))_{\sigma(stem(man(id=t, lastname)) \in content(id = g, cont))})),\}$$


